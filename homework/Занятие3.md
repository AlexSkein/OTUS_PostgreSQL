# Отчет по домашке №3

1. создайте виртуальную машину c Ubuntu 20.04/22.04 LTS в ЯО/Virtual Box/докере
    создана на занятии 2
1. поставьте на нее PostgreSQL 15 через sudo apt
    установлен postgres 17 на занятии 2
1. проверьте что кластер запущен через sudo -u postgres pg_lsclusters
    На Alt linux нет этой утилиты. Проверяем
    ```
    sudo systemctl status postgresql
    ```
    ![pg](/img/3/1.jpg)

1. зайдите из под пользователя postgres в psql и сделайте произвольную таблицу с произвольным содержимым
    ```
    postgres=# create table test2(c1 text);
    postgres=# insert into test2 values('1');
    \q
    ```
    ![pg](/img/3/2.jpg)

1. остановите postgres например через sudo -u postgres pg_ctlcluster 15 main stop
    ```
    sudo systemctl stop postgresql
    ```
    ![pg](/img/3/3.jpg)
    
1. создайте новый диск к ВМ размером 10GB добавьте свеже-созданный диск к виртуальной машине перезагрузите инстанс и убедитесь, что диск остается примонтированным (если не так смотрим в сторону fstab)

    ![pg](/img/3/4.jpg)

1. сделайте пользователя postgres владельцем /mnt/data 
    ```
    chown -R postgres:postgres /mnt/data/
    ```

1. перенесите содержимое /var/lib/postgres/15 в /mnt/data 

    ```
    mv /var/lib/postgresql/15 /mnt/data
    ```
1. попытайтесь запустить кластер - sudo -u postgres pg_ctlcluster 15 main start

    ```
        sudo systemctl start postgresql
    ```

    ![pg](/img/3/5.jpg)

1. напишите получилось или нет и почему

Не получилось, поскольку при запуске сервиса по пути /var/lib/pgresql/data ничего нет

1. задание: найти конфигурационный параметр в файлах раположенных в /etc/postgresql/15/main который надо поменять и поменяйте его
    
Параметр в файлах, раположенных в /etc/postgresql/15/main найти не получится, поскольку в /etc нет каталога postgresql

1. напишите что и почему поменяли

Соответственно ничего не менял

1. попытайтесь запустить кластер - sudo -u postgres pg_ctlcluster 15 main start

Даже не пытался запустить кластер по данной инструкции
Сразу отправился в каталог /lib/systmd/system/postgresql.service
И меняем Environment=PGDATA на /mnt/data

![pg](/img/3/6.jpg)

напишите получилось или нет и почему
    
    Обновляем настройки демонов и стартуем postgresql

    ```
        sudo systemctl daemon-reload
        sudo systemctl start postgresql
    ```
    Ура! Заработало!

   ![pg](/img/3/7.jpg)


зайдите через через psql и проверьте содержимое ранее созданной таблицы

Все на месте!

    ![pg](/img/3/8.jpg)


