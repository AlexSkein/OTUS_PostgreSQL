# Отчет по домашке №9

1. Реализовать прямое соединение двух или более таблиц

**Создадим 2 таблицы**

```SQL
CREATE TABLE public.persons (
	id serial4 NOT NULL,
	first_name text NULL,
	second_name text NULL
);

CREATE TABLE public.tickets (
	id serial4 NOT NULL,
	id_person int4 NOT NULL,
	ticket_number text NULL
);
```
**Заполним таблицы**

```SQL
INSERT INTO public.persons
(first_name, second_name)
VALUES
    ('ivan', 'ivanov'),
    ('petr', 'petrov'),
    ('sergey', 'sergeev'),
    ('sveta', 'svetova');

INSERT INTO public.tickets
(id_person, ticket_number)
VALUES(1, 'T234565000'),
    (1, 'T234565001'),
    (1, 'T234565002'),
    (2, 'T234565003'),
    (2, 'T234565004'),
    (3, 'T234565005'),
    (3, 'T234565006'),
    (3, 'T234565008'),
    (4, 'T234565009'),
    (4, 'T234565010');
```

**Соединим таблицы по столбцу ИД персоны.**

```SQL
    select * from persons p join tickets t on p.id =t.id_person ;
```

![pg](/img/9/1.png)


Реализовать левостороннее (или правостороннее) соединение двух или более таблиц

**Добавим нового пользователя**

```SQL
INSERT INTO public.persons
(first_name, second_name)
VALUES
    ('semen', 'semenov')
```
в выдаче его нет.
Изменим запрос
```SQL
    select * from persons p left join tickets t on p.id =t.id_person ;
```
![pg](/img/9/2.png)

 Недостающие данные в правой таблице заменены NULL

Реализовать кросс соединение двух или более таблиц
```SQL
    select * from persons p cross join tickets t;
```
![pg](/img/9/3.png)

 Результатом будет скалярное произведение таблиц (50 строк)
 
Реализовать полное соединение двух или более таблиц

Для этого добавим билетов

```SQL
INSERT INTO public.tickets
(id_person, ticket_number)
VALUES
    (0, 'T234565000'),
    (0, 'T234565001'),
    (0, 'T234565002'),
    (0, 'T234565003');
```

```SQL
select * from persons p full outer join tickets t on p.id =t.id_person ;
```

![pg](/img/9/4.png)

 Недостающие данные заменены в обеих таблицах

Реализовать запрос, в котором будут использованы разные типы соединений

Для этого потребуется еще таблица

```SQL
CREATE TABLE public.discount (
	id serial4 NOT NULL,
	discount int4 NOT NULL
);
INSERT INTO public.discount
(discount)
values (5), (10), (15);
```
Добавим скидки в persons

```SQL
ALTER TABLE public.persons ADD id_discount int2 NULL;
update persons p set id_discount = 1 where p.id = 1; -- 5% Ивану
update persons p set id_discount = 2 where p.id = 4; -- 10% Светлане
select * from (persons p  join tickets t on p.id =t.id_person) left join discount d on p.id_discount = d.id  ;
```
![pg](/img/9/5.png)

 Получили таблицу со скидками.

