# Отчет по домашке №9

1. Реализовать прямое соединение двух или более таблиц

**Создадим 2 таблицы**

```SQL
CREATE TABLE public.persons (
	id serial4 NOT NULL,
	first_name text NULL,
	second_name text NULL
);

CREATE TABLE public.tickets (
	id serial4 NOT NULL,
	id_person int4 NOT NULL,
	ticket_number text NULL
);
```
**Заполним таблицы**

```SQL
INSERT INTO public.persons
(first_name, second_name)
VALUES
    ('ivan', 'ivanov'),
    ('petr', 'petrov'),
    ('sergey', 'sergeev'),
    ('sveta', 'svetova');

INSERT INTO public.tickets
(id_person, ticket_number)
VALUES(1, 'T234565000'),
    (1, 'T234565001'),
    (1, 'T234565002'),
    (2, 'T234565003'),
    (2, 'T234565004'),
    (3, 'T234565005'),
    (3, 'T234565006'),
    (3, 'T234565008'),
    (4, 'T234565009'),
    (4, 'T234565010');
```

**Соединим таблицы по столбцу ИД персоны.**

```SQL
    select * from persons p join tickets t on p.id =t.id_person ;
```
id|first_name|second_name|id|id_person|ticket_number|
--+----------+-----------+--+---------+-------------+
 1|ivan      |ivanov     | 1|        1|T234565000   |
 1|ivan      |ivanov     | 2|        1|T234565001   |
 1|ivan      |ivanov     | 3|        1|T234565002   |
 2|petr      |petrov     | 4|        2|T234565003   |
 2|petr      |petrov     | 5|        2|T234565004   |
 3|sergey    |sergeev    | 6|        3|T234565005   |
 3|sergey    |sergeev    | 7|        3|T234565006   |
 3|sergey    |sergeev    | 8|        3|T234565008   |
 4|sveta     |svetova    | 9|        4|T234565009   |
 4|sveta     |svetova    |10|        4|T234565010   |

Реализовать левостороннее (или правостороннее) соединение двух или более таблиц

**Добавим нового пользователя**

```SQL
INSERT INTO public.persons
(first_name, second_name)
VALUES
    ('semen', 'semenov')
```
в выдаче его нет.
Изменим запрос
```SQL
    select * from persons p left join tickets t on p.id =t.id_person ;
```
id|first_name|second_name|id|id_person|ticket_number|
--+----------+-----------+--+---------+-------------+
 1|ivan      |ivanov     | 1|        1|T234565000   |
 1|ivan      |ivanov     | 2|        1|T234565001   |
 1|ivan      |ivanov     | 3|        1|T234565002   |
 2|petr      |petrov     | 4|        2|T234565003   |
 2|petr      |petrov     | 5|        2|T234565004   |
 3|sergey    |sergeev    | 6|        3|T234565005   |
 3|sergey    |sergeev    | 7|        3|T234565006   |
 3|sergey    |sergeev    | 8|        3|T234565008   |
 4|sveta     |svetova    | 9|        4|T234565009   |
 4|sveta     |svetova    |10|        4|T234565010   |
 5|semen     |semenov    |  |         |             |

 Недостающие данные в правой таблице заменены NULL

Реализовать кросс соединение двух или более таблиц
```SQL
    select * from persons p cross join tickets t;
```
id|first_name|second_name|id|id_person|ticket_number|
--+----------+-----------+--+---------+-------------+
 1|ivan      |ivanov     | 1|        1|T234565000   |
 2|petr      |petrov     | 1|        1|T234565000   |
 3|sergey    |sergeev    | 1|        1|T234565000   |
 4|sveta     |svetova    | 1|        1|T234565000   |
 5|semen     |semenov    | 1|        1|T234565000   |
 1|ivan      |ivanov     | 2|        1|T234565001   |
 2|petr      |petrov     | 2|        1|T234565001   |
 3|sergey    |sergeev    | 2|        1|T234565001   |
 4|sveta     |svetova    | 2|        1|T234565001   |
 5|semen     |semenov    | 2|        1|T234565001   |
 1|ivan      |ivanov     | 3|        1|T234565002   |
 2|petr      |petrov     | 3|        1|T234565002   |
 3|sergey    |sergeev    | 3|        1|T234565002   |
 4|sveta     |svetova    | 3|        1|T234565002   |
 5|semen     |semenov    | 3|        1|T234565002   |
 1|ivan      |ivanov     | 4|        2|T234565003   |
 2|petr      |petrov     | 4|        2|T234565003   |
 3|sergey    |sergeev    | 4|        2|T234565003   |
 4|sveta     |svetova    | 4|        2|T234565003   |
 5|semen     |semenov    | 4|        2|T234565003   |
 1|ivan      |ivanov     | 5|        2|T234565004   |
 2|petr      |petrov     | 5|        2|T234565004   |
 3|sergey    |sergeev    | 5|        2|T234565004   |
 4|sveta     |svetova    | 5|        2|T234565004   |
 5|semen     |semenov    | 5|        2|T234565004   |
 1|ivan      |ivanov     | 6|        3|T234565005   |
 2|petr      |petrov     | 6|        3|T234565005   |
 3|sergey    |sergeev    | 6|        3|T234565005   |
 4|sveta     |svetova    | 6|        3|T234565005   |
 5|semen     |semenov    | 6|        3|T234565005   |
 1|ivan      |ivanov     | 7|        3|T234565006   |
 2|petr      |petrov     | 7|        3|T234565006   |
 3|sergey    |sergeev    | 7|        3|T234565006   |
 4|sveta     |svetova    | 7|        3|T234565006   |
 5|semen     |semenov    | 7|        3|T234565006   |
 1|ivan      |ivanov     | 8|        3|T234565008   |
 2|petr      |petrov     | 8|        3|T234565008   |
 3|sergey    |sergeev    | 8|        3|T234565008   |
 4|sveta     |svetova    | 8|        3|T234565008   |
 5|semen     |semenov    | 8|        3|T234565008   |
 1|ivan      |ivanov     | 9|        4|T234565009   |
 2|petr      |petrov     | 9|        4|T234565009   |
 3|sergey    |sergeev    | 9|        4|T234565009   |
 4|sveta     |svetova    | 9|        4|T234565009   |
 5|semen     |semenov    | 9|        4|T234565009   |
 1|ivan      |ivanov     |10|        4|T234565010   |
 2|petr      |petrov     |10|        4|T234565010   |
 3|sergey    |sergeev    |10|        4|T234565010   |
 4|sveta     |svetova    |10|        4|T234565010   |
 5|semen     |semenov    |10|        4|T234565010   |

 Результатом будет скалярное произведение таблиц (50 строк)
 
Реализовать полное соединение двух или более таблиц

Для этого добавим билетов

```SQL
INSERT INTO public.tickets
(id_person, ticket_number)
VALUES
    (0, 'T234565000'),
    (0, 'T234565001'),
    (0, 'T234565002'),
    (0, 'T234565003');
```

```SQL
select * from persons p full outer join tickets t on p.id =t.id_person ;
```

id|first_name|second_name|id|id_person|ticket_number|
--+----------+-----------+--+---------+-------------+
 1|ivan      |ivanov     | 1|        1|T234565000   |
 1|ivan      |ivanov     | 2|        1|T234565001   |
 1|ivan      |ivanov     | 3|        1|T234565002   |
 2|petr      |petrov     | 4|        2|T234565003   |
 2|petr      |petrov     | 5|        2|T234565004   |
 3|sergey    |sergeev    | 6|        3|T234565005   |
 3|sergey    |sergeev    | 7|        3|T234565006   |
 3|sergey    |sergeev    | 8|        3|T234565008   |
 4|sveta     |svetova    | 9|        4|T234565009   |
 4|sveta     |svetova    |10|        4|T234565010   |
  |          |           |11|        0|T234565000   |
  |          |           |12|        0|T234565001   |
  |          |           |13|        0|T234565002   |
  |          |           |14|        0|T234565003   |
 5|semen     |semenov    |  |         |             |

 Недостающие данные заменены в обеих таблицах

Реализовать запрос, в котором будут использованы разные типы соединений

Для этого потребуется еще таблица

```SQL
CREATE TABLE public.discount (
	id serial4 NOT NULL,
	discount int4 NOT NULL
);
INSERT INTO public.discount
(discount)
values (5), (10), (15);
```
Добавим скидки в persons

```SQL
ALTER TABLE public.persons ADD id_discount int2 NULL;
update persons p set id_discount = 1 where p.id = 1; -- 5% Ивану
update persons p set id_discount = 2 where p.id = 4; -- 10% Светлане
select * from (persons p  join tickets t on p.id =t.id_person) left join discount d on p.id_discount = d.id  ;
```
id|first_name|second_name|id_discount|id|id_person|ticket_number|id|discount|
--+----------+-----------+-----------+--+---------+-------------+--+--------+
 1|ivan      |ivanov     |          1| 1|        1|T234565000   | 1|       5|
 1|ivan      |ivanov     |          1| 2|        1|T234565001   | 1|       5|
 1|ivan      |ivanov     |          1| 3|        1|T234565002   | 1|       5|
 4|sveta     |svetova    |          2| 9|        4|T234565009   | 2|      10|
 4|sveta     |svetova    |          2|10|        4|T234565010   | 2|      10|
 3|sergey    |sergeev    |           | 6|        3|T234565005   |  |        |
 3|sergey    |sergeev    |           | 7|        3|T234565006   |  |        |
 3|sergey    |sergeev    |           | 8|        3|T234565008   |  |        |
 2|petr      |petrov     |           | 4|        2|T234565003   |  |        |
 2|petr      |petrov     |           | 5|        2|T234565004   |  |        |

 Получили таблицу со скидками.

