# Отчет по домашке №13

**Создаем БД, схему, таблицы**

    CREATE DATABASE dbtest13;
    CREATE DATABASE
    postgres=# \c dbtest13;
    You are now connected to database "dbtest13" as user "postgres".
    dbtest13=# CREATE SCHEMA schema13;
    CREATE SCHEMA
    dbtest13=# CREATE TABLE schema13.t1 AS
    SELECT
    generate_series(1,100) as id,
    md5(random()::text)::char(10) as fio;
    SELECT 100
    dbtest13=# SELECT count (*) FROM schema13.t1;
    count
    -------
    100
    (1 row)
    dbtest13=# CREATE TABLE schema13.t2 AS SELECT * FROM schema13.t1 LIMIT 0;
    SELECT 0
    dbtest13=# SELECT COUNT (*) FROM schema13.t2;
    count
    -------
        0
    (1 row)

**Создаем папку и выдаем права**

    root@srv-tmp-uis:~# pwd
    /root
    root@srv-tmp-uis:~# mkdir copy
    root@srv-tmp-uis:~# chown postgres copy
    root@srv-tmp-uis:~# ll copy
    total 8
    drwxr-xr-x 2 postgres root 4096 Aug 14 19:47 ./
    drwx------ 5 root     root 4096 Aug 14 19:47 ../

**Копируем первую таблицу в файл, а потом файл загружаем во вторую таблицу**

    dbtest13=# \copy schema13.t1 to /root/copy/t1.sql
    COPY 100
    dbtest13=# \copy schema13.t2 from /root/copy/t1.sql
    COPY 100
    dbtest13=# select count (*) from schema13.t2;
    count
    -------
    100
    (1 row)

**Сделаем бэкап обеих таблиц через pg_dump**

    root@srv-tmp-uis:~# pg_dump -U postgres -d dbtest13 -t schema13.t1 -t schema13.t2 -Fc > /root/copy/backup.gz

**Удалим вторую таблицу**

    dbtest13=# DROP table schema13.t2;
    DROP TABLE

**Восстановим из сделанного бэкапа токмо вторую таблицу**

    root@srv-tmp-uis:~# pg_restore -U postgres -d dbtest13 -t t2 -n schema13 /root/copy/backup.gz
    root@srv-tmp-uis:~# psql -U postgres -d dbtest13
    psql (17.5 (Ubuntu 17.5-1.pgdg24.04+1))
    Type "help" for help.

    dbtest13=# SELECT count (*) FROM schema13.t2;
    count
    -------
    100
    (1 row)

