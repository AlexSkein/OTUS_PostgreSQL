# Отчет по домашке №11

1. Выбор таблицы для секционирования:
Основной акцент делается на секционировании таблицы bookings. Но вы можете выбрать и другие таблицы, если видите в этом смысл для оптимизации производительности (например, flights, boarding_passes).
Обоснуйте свой выбор: почему именно эта таблица требует секционирования? Какой тип данных является ключевым для секционирования?
> Довольно сложно выбрать из двух столбцов по какому разбивать таблицу
Принял решение разбить по коду бронирования, поскольку он, на мой взгляд, чаще будет использоваться в запросах. Т.К. поле типа bpchar, разбил по хэшу на равные части


```SQL
--создание секционированной таблицы
CREATE TABLE bookings.bookings_p (
	book_ref bpchar(6) NOT NULL,
	book_date timestamptz NOT NULL,
	total_amount numeric(10, 2) NOT NULL,
	CONSTRAINT bookings_p_pkey PRIMARY KEY (book_ref)
) partition by hash(book_ref);

--создание секций
CREATE TABLE bookings_p_1 PARTITION OF bookings_p FOR VALUES WITH (MODULUS 3, REMAINDER 0);
CREATE TABLE bookings_p_2 PARTITION OF bookings_p FOR VALUES WITH (MODULUS 3, REMAINDER 1);
CREATE TABLE bookings_p_3 PARTITION OF bookings_p FOR VALUES WITH (MODULUS 3, REMAINDER 2);

-- копирование данных в секционированную таблицу
insert into bookings.bookings_p select * from bookings.bookings;
```
**Сравним идентичные запросы к исходной и партиционированной таблице**

```SQL
explain analyse
select * from bookings b where b.book_ref = 'J9AZI6';
```
QUERY PLAN                                                                                                               \
-------------------------------------------------------------------------------------------------------------------------+\
Index Scan using bookings_pkey on bookings b  (cost=0.43..8.45 rows=1 width=21) (actual time=0.022..0.022 rows=1 loops=1)\
  Index Cond: (book_ref = 'J9AZI6'::bpchar)                                                                              \
Planning Time: 0.049 ms                                                                                                  \
Execution Time: 0.033 ms                                                                                                 \
```SQL
explain analyse
select * from bookings_p b where b.book_ref = 'J9AZI6';
```
QUERY PLAN                                                                                                                       \
---------------------------------------------------------------------------------------------------------------------------------+\
Index Scan using bookings_p_2_pkey on bookings_p_2 b  (cost=0.42..8.44 rows=1 width=21) (actual time=0.021..0.022 rows=1 loops=1)\
  Index Cond: (book_ref = 'J9AZI6'::bpchar)                                                                                      \
Planning Time: 0.084 ms                                                                                                          \
Execution Time: 0.034 ms                                                                                                         \

> Отчетливо видно, что используется партиция, но выигрыш по времени отсутствует. Поскольку партиция в 3 раза меньше исходной таблицы, 
предположим, что преимущества проявятся при запросах с объединением таблицы с другими. Будет экономиться память, по крайней мере

